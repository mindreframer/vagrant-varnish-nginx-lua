#user  nobody;
worker_processes  1;
# we're using runit, don't daemonize!
# http://wiki.nginx.org/CoreModule#daemon
daemon off;

error_log logs/error.log debug;

events {
  worker_connections 1024;
}

http {
  server {
    listen 9999;

    location = /test {

      # access_by_lua "
      #   ngx.log(ngx.DEBUG, 'ACCESS PHASE')
      #   require('accelerator').access({ host='127.0.0.1', port=11211 })
      # ";

      # proxy_pass http://127.0.0.1:8081/;

      access_by_lua "require('accelerator').access({ host='127.0.0.1', port=11211 })";
    }


    location = /template{
      #content_by_lua_file '/tmp/test_template.lua';
      content_by_lua '
      local lustache = require "lustache"

      view_model = {
        title = "Joe",
        calc = function ()
          return 2 + 4;
        end
      }

      output = lustache:render("{{title}} spends {{calc}}", view_model)
      ngx.say(output)
      ';
    }
  }


# https://github.com/winton/nginx-accelerator
##### template handling with LUA








  # server {
  #   listen 8081;

  #   location = / {

  #     more_set_headers "Cache-Control: max-age=1";

  #     content_by_lua "
  #       ngx.log(ngx.DEBUG, 'CONTENT PHASE')
  #       ngx.say(os.time())
  #     ";
  #   }
  # }
}